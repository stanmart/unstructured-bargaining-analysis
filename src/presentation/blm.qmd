---
title: "Unstructured bargaining experiment"
author:
 - Mia Lu
 - Martin Stancsics
format:
  revealjs:
    embed-resources: true
    theme:
      - default
      - include/custom.scss
    include-in-header:
      - include/mathjax-settings.html
      - include/sections-in-footer.html
    toc: true
    toc-depth: 1
    toc-title: Agenda
---

# Introduction

## Literature – bargaining experiments
:::: {.smaller}
::: {.fragment}
- Early unstructured bargaining papers (1950s-1990s):  
  - E.g. @Kalischetal1952, @Maschler1965, @NydeggerOwen1974, @RapoportKahan1976, **@MurnighanRoth1977**, @MurnighanRoth1978, @Micheneretal1979, @MichenerPotter1981, **@LeopoldWildburger1992** 
  - Face to face bargaining, different experimental standards
:::
::: {.fragment}
- Free-form bargaining
  - E.g. @Galeottietal2018, @HossainLyonsSiow2020, **@NavarroVeszteg2020**
  - Almost always bilateral
:::
::: {.fragment}
- Multi-lateral bargaining
  - E.g. @MonteroSeftonZhang2008, @MitsutsuneTakanori2014, @TremewanVanberg2016, @chessa2022experiment, **@ShinodaFunaki2022**
  - Structured or semi-structured
:::
::: {.fragment}
- Fairness views in bargaining
  - E.g. @LuhanPoulsenRoos2019, **@Schwaninger2022**, **@ClippelRozen2022**
:::
::::


# Game and solution concepts

## The game

::: {.fragment}
- Players: $N = \{A, B_1, B_2\}$
:::
::: {.fragment}
- Value function:
  - No one can create any value alone: $v(\{A\}) = v(\{B_i\}) = 0$
  - Player $A$ is indispensable: $v(\{B_1, B_2\}) = 0$
  - Small players contribute to the value: $v(\{A, B_i\}) = Y \in [0, 100]$
  - The more small players the better: $v(\{A, B_1, B_2\}) = 100$
:::

::: {.highlight-block .fragment}
How to divide the value between the players?
:::

## Core

- The set of payoff vectors such that no sub-coalition has a larger value than the sum of their payoffs
  - Stability-based concept
  - Similar idea to the Nash equilibrium, but for multi-player deviations
- Very intuitive and plausible, but
  - Can be empty (existence not guaranteed)
  - Can be multi-valued (uniqueness not guaranteed)

## Nucleolus

- Maximizes the smallest excess (sum of payoffs minus value) across coalitions
  - Not as nice intuition as for the core, but...
  - if the core is non-empty, the nucleolus is in the core
- Useful properties
  - Always exists
  - Always unique
- Can be thought of as a way to mix the stability-based intuition behind the core with useful properties

## Shapley value

- Each players gets their average marginal contribution
  - Fairness based motivation
- Appealing characterization
  - Efficient: whole pie is distributed
  - Symmetric: identical (from the pov of $v$) players should get the same payoff
  - Dummy player property: players contributing nothing get nothing
  - Linearity (across games)
- Useful properties
  - Always exists
  - Always unique

## In our game
![](/out/figures/values_theory.svg)

# Experimental design 

## General structure

- Conducted in the BLU lab (May 2024)
  - 4 treatments/sessions: $Y=10$, $Y=30$, $Y=90$, dummy player
  - 144 subjects in total (36 subjects per session) 
- Timing: 
  - Instructions with comprehension checks
  - Slider task
  - Trial round + 5 bargaining rounds (5 minutes each)
  - Survey (demographics, reasoning, axioms)
- Payment: 
  - Conversion: 1 point = 0.6CHF
  - Subjects are paid their average payoff across all rounds + show-up fee

## Role and group assignment

- Player roles are assigned stochastically based on players' performance in the slider task
  - the better they perform, the higher the likelihood of becoming Player A
- Stranger matching for bargaining groups each round
  - no set of subjects is matched twice
- Split each session into 6 matching groups (à 6 players) in order to account for dependence between rounds in the analysis
  - Bargaining groups are only redrawn within matching groups

## Bargaining

- Bargaining via public chat 
- Interface for submitting proposals and current acceptances to facilitate bargaining
- Free-form bargaining: 
  - Unlimited number of proposals 
  - No restrictions on the order of proposals and acceptances 
  - Acceptances are not binding and can be changed any time
- At the end of each bargaining round: 
  - Current acceptances are taken as final decisions
  - A proposal is successful only if all members of a coalition agree on it
  

# Main results

## Payoffs – aggregate
:::: {.columns}

::: {.column width="65%"}
![](/out/figures/payoff_average.svg){width=100% height=100%}
:::

:::{.column width="35%" .smaller}
- Dummy player gets something
- $Y=10$ and $Y=30$ treatments look similar
- Player A gets more in $Y=30$ treatment
- Nucleolus better in terms of 'shape' but worse in terms of 'distance'
:::

::::

## Payoff of Player A – regression

::: {.smaller}
```{python}
import pickle
from statsmodels.iolib.summary2 import summary_col

with open("out/analysis/regression.pkl", "rb") as reg:
    regression_continuous = pickle.load(reg)
with open("out/analysis/regression_dummies.pkl", "rb") as reg:
    regression_dummies = pickle.load(reg)

table = summary_col(
    [regression_continuous, regression_dummies],
    stars=True,
    float_format="%.2f",
    model_names=["Model cont.", "Model ind."],
    include_r2=False,
    info_dict={"N": lambda reg: f"{int(reg.nobs):d}"}
)
table.extra_txt[0] = "Matching-group-level clustered standard errors in parentheses."
table
```

:::

## Payoffs – a deeper look
:::: {.columns}

::: {.column width="65%"}
![](/out/figures/payoff_scatterplot.svg){width=100% height=100%}
:::

:::{.column width="35%" .smaller}
- In all treatments, equal(ish) split is a frequent outcome
  - Even in the dummy player treatment!
- $Y=10$ and $Y=30$ treatments still look similar
- In the $Y=90$ treatment, A can occasionally do much better
:::

::::

## Payoff of Player A – non-parametrics

Mann-Whitney test comparing Player A's payoff across groups

::: {.smaller}
```{python}
import json
import pandas as pd

with open("out/analysis/mann_whitney.json", "r") as mw:
    mw_results = json.load(mw)

table = pd.DataFrame.from_records(mw_results).T
table = table.rename(columns={
    "statistic": "U statistic",
    "pvalue": "p-value",
})
table = table.rename(
    index=lambda s: " < ".join(f"[Y = {t}]" for t in s.split("-"))
)
table

```

:::

- Qualitatively agrees with the nucleolus and disagrees with SV
- Quantitatively disagrees with both (cf. plots)

# Exploratory observations

## Payoffs by coordination outcomes
:::: {.columns}

::: {.column width="65%"}
![](/out/figures/payoff_by_agreement_type.svg){width=100% height=100%}
:::

:::{.column width="35%" .smaller}
- In the $Y=90$ treatment, A only achieves significantly higher than ES by excluding one small player
  - Not efficient
  - Why doesn't the excluded player seem to want the remaining 10 points
- The outcomes are still not stable
  - excluded player could make a counter-offer
:::

::::

## Between matching group variance
![](/out/figures/payoff_matching_group_average.svg)


# Testing the axioms {.unlisted .unnumbered}

## Efficiency
:::: {.columns}

::: {.column width="60%"}
![](/out/figures/axioms_outcomes_efficiency.svg){width=100% height=100%}
:::

:::{.column width="40%"}
![](/out/figures/axioms_survey_efficiency-2col.svg){width=100% height=80%}
:::

::::

## Symmetry
:::: {.columns}

::: {.column width="60%"}
![](/out/figures/axioms_outcomes_symmetry.svg){width=100% height=100%}
:::

:::{.column width="40%"}
![](/out/figures/axioms_survey_symmetry-2col.svg){width=100% height=80%}
:::

::::

## Dummy player axiom
:::: {.columns}

::: {.column width="60%"}
![](/out/figures/axioms_outcomes_dummy_player.svg){width=100% height=100%}
:::

:::{.column width="40%"}
![](/out/figures/axioms_survey_dummy_player-2col.svg){width=100% height=80%}
:::

::::

## Stability
:::: {.columns}

::: {.column width="60%"}
![](/out/figures/axioms_outcomes_stability.svg){width=100% height=100%}
:::

:::{.column width="40%"}
![](/out/figures/axioms_survey_stability-2col.svg){width=100% height=80%}
:::

::::

## Linearity
![](/out/figures/axioms_outcomes_linearity_additivity.svg)

## Linearity
:::: {.columns}

::: {.column width="40%"}
![](/out/figures/axioms_survey_linearity_HD1-2col.svg){width=100% height=100%}
:::

:::{.column width="40%"}
![](/out/figures/axioms_survey_linearity_additivity-2col.svg){width=100% height=80%}
:::

::::

# Real-time interactions {.unlisted .unnumbered}

## Time of proposing and accepting final allocation
![](/out/figures/timing_until_decision.svg)

::: {.smaller}
- Most final allocations are proposed within the first minute
:::

## Time of accepting final allocation
![](/out/figures/timing_until_agreement_scatterplot.svg)

::: {.smaller}
- Most agreement times are well before the end of the bargaining time
- In the $Y=90$ treatment, partial agreements come later
- Otherwise, agreement times are broadly similar across the main treatments
:::

## Chat logs

- Have around 6000 chat messages in total
  - Participants interacted intensively over chat
  - Quality is rather messy (typos, slang, etc.)
- What to do with it?
  - Find words that are relatively more prevalent depending on the outcome
  - Classify messages into categories (e.g. fairness-related, small talk, etc.) 
    - Use an LLM through an API
    - Manually classify some and finetune a BERT-like model to classify the rest
  - Can also learn things like people's understanding of the game
- In general, would probably need *much* more data for proper NLP analysis

## Chat – Stability-based reasoning

::: {layout-ncol=3}
![Y = 10](/out/figures/chat_excerpt-2702-2707.svg){.chatlog}

![Y = 30](/out/figures/chat_excerpt-5640,5647-5648,5660-5663.svg){.chatlog}

![Y = 90](/out/figures/chat_excerpt-6846-6847,6849,6851,6853,6855,6857,6859.svg){.chatlog}
:::

## Chat – Fairness-based reasoning

::: {layout-ncol=3}
![Equal split](/out/figures/chat_excerpt-7052,7054,7057-7063.svg){.chatlog}

![A gets a bit more](/out/figures/chat_excerpt-7590-7596,7598-7599.svg){.chatlog}

![Rejecting small offers](/out/figures/chat_excerpt-7894-7901,7906.svg){.chatlog}
:::

## Chat – Dummy player treatment

::: {layout-ncol=3}
![Altruism](/out/figures/chat_excerpt-8,10,11,17-21.svg){.chatlog}

![Abuse of position](/out/figures/chat_excerpt-1104-1111.svg){.chatlog}

![Appeal to pity](/out/figures/chat_excerpt-1371-1376.svg){.chatlog}
:::

## Chat – Feedback about experiment

::: {layout-ncol=3}
![Having a chat](/out/figures/chat_excerpt-6508-6509,6511,6513,6524,6527,6528-6529.svg){.chatlog}

![Payouts](/out/figures/chat_excerpt-286-291.svg){.chatlog}

![Bargaining time](/out/figures/chat_excerpt-5501-5508.svg){.chatlog}
:::


# Conclusions

## What we did

- **Free-form bargaining** is important to understand
  - More realistic than strictly controlled designs
  - NCGT have trouble describing it → check if CGT is predictive
- Players could bargain for 5 minutes **without any binding actions**
  - An interface for proposing and accepting allocations
  - Group-level unrestricted **chat**
- **Vary the necessity of including both small players** between treatments

## Main takeaways

- **Nucleolus** gives **qualitatively correct** predictions, Shapley value does not
  - People might think in terms of **stability** and profitable deviations
- **Both fail quantitatively**, especially when the big player has lots of bargaining power
  - **Fairness** considerations seem to be important
  - Although not in the "marginal contribution" way that SV is based on
- People's **stated preferences** (axiom survey) **and actions disagree**
  - What would happen if these axioms were mentioned before the bargaining?

## Future research

- **Chat logs** are useful even in lieu of proper analysis
  - Going through them reveals a lot about players' understanding of the game
- We have a **rich dataset** (real time actions)
  - Good for exploratory analysis and to inform study design in the future
  - Not sure what aspects to look into more deeply – **ideas?**
- Differences between matching groups
  - Maybe just player heterogeneity
  - Or norms / reference values determined in the first couple of rounds?


# Thank you {.unnumbered .unlisted}

## References

::: {#refs}
:::

## Appendix 

## Bargaining interface 

![](/src/screenshots/bargaining_interface.png){width=50% height=25%}

## Survey (axioms)

![](/src/screenshots/survey_axioms.png){width=80% height=80%}

## Balance (age)
![](/out/figures/survey_age.svg)

## Balance (gender)
![](/out/figures/survey_gender.svg)

## Balance (degree)
![](/out/figures/survey_degree.svg)

## Balance (study fields)
![](/out/figures/survey_study_fields.svg)

## Balance (nationality)
![](/out/figures/survey_nationality.svg)

## Balance (difficulty rating)
![](/out/figures/survey_difficulty_rating.svg)
